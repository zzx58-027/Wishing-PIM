如果在 GitHub 仓库中意外泄露了密码或敏感信息（如 API Key、数据库密码、Token 等），必须**立即采取行动**降低风险。以下是详细的补救步骤：

---

### **1. 紧急处理：立即删除或修改泄露的密码**
#### **步骤**
1. **删除文件或敏感内容**
   - 直接删除包含密码的文件（如 `config.json`、`.env`），或使用 `git rm` 命令清除历史记录。
   - **注意**：仅删除文件无法彻底清除历史记录（Git 会保留提交记录）。

2. **修改所有关联的密码**
   - **立即重置**所有已泄露的密码、API Key、Token（优先处理生产环境凭据）。
   - 通知相关团队或服务提供商（如 AWS、数据库厂商）撤销旧凭据。

---
一定要先备份仓库（因为它会重写所有历史）。
git clone --mirror https://github.com/zzx58-027/Wishing-PIM.git repo-backup.git

### **2. 彻底清理 Git 历史记录**
即使删除文件，Git 历史记录中仍可能保留敏感信息。需使用以下工具清理：
#### **方法 1：使用 `git filter-repo`（推荐）**
```bash
# 安装 filter-repo（若未安装）
pip install git-filter-repo

# 删除所有历史记录中的敏感文件（例如 .env）
git filter-repo --path .env --invert-paths

# 或替换文件中的密码字符串（将 '***' 替换为 '***'）
git filter-repo --replace-text <(echo "***==>***")
```
#### **方法 2：使用 BFG Repo-Cleaner（适合大仓库）**
```bash
java -jar bfg.jar --replace-text passwords.txt my-repo.git
```
**强制推送清理后的仓库**（⚠️ 这会覆盖所有历史）：
```bash
git push origin --force --all
git push origin --force --tags
```

---

### **3. 启用 GitHub 的自动防护**
- **扫描现有仓库**：
  GitHub 会通过 [Secret Scanning](https://docs.github.com/en/code-security/secret-scanning/about-secret-scanning) 自动检测常见凭据（如 AWS Key），但需确保仓库是公开的或已启用企业版功能。
- **设置推送前检测**：
  使用 [GitHub Actions](https://github.com/marketplace/actions/secret-scanner) 或本地工具（如 [git-secrets](https://github.com/awslabs/git-secrets)）防止再次泄露。

---

### **4. 后续安全措施**
| 措施                     | 说明                                                                 |
|--------------------------|----------------------------------------------------------------------|
| **使用环境变量**         | 将敏感信息存储在 `.env` 中，并添加到 `.gitignore`。                 |
| **加密敏感文件**         | 使用 [git-crypt](https://github.com/AGWA/git-crypt) 或 [SOPS](https://github.com/mozilla/sops)。 |
| **审查所有历史提交**     | 定期检查仓库历史（`git log -p` 或工具如 [Gitleaks](https://github.com/zricethezav/gitleaks)）。 |
| **限制仓库访问权限**     | 设置最小权限原则，仅允许必要人员访问敏感仓库。                       |

---

### **5. 监控与响应**
- **检查泄露影响**：
  使用 [Have I Been Pwned](https://haveibeenpwned.com/) 或 [Debricked](https://debricked.com/) 查看凭据是否被恶意使用。
- **日志审计**：
  检查相关服务日志（如数据库、API）是否有异常访问。

---

### **重要提醒**
- **GitHub 仓库公开后，即使删除，仍可能被第三方存档**（如 [Wayback Machine](https://archive.org/)）。
- 如果泄露的是高敏感凭据（如 AWS Root Key），建议**全账户轮换凭据**并联系云服务商支持。

及时行动可以极大降低风险！